<!DOCTYPE html>
<html>
<head>
	<title>protobuf Test</title>
	<script type="text/javascript" src="/externs/require.min.js"></script>
</head>
<body>
<script type="text/javascript">
	require.config({
		"baseUrl": "/",
		"paths": {
			"io": "/externs/socket.io",
			"text": "/externs/text",
			"Math/Long": "/externs/Long",
			"ByteBuffer": "/externs/ByteBuffer",
			"ProtoBuf": "/ProtoBuf"
		}
	});

	define('dtos', ['ProtoBuf'], function(ProtoBuf) {
		return ProtoBuf.newBuilder().import({
			"package": null,
			"messages": [
				{
					"name": 'Foo',
					"fields": [
						{
							"rule": "optional",
							"type": "string",
							"name": "fizz",
							"id": 1,
							"options": {}
						}
					],
					"enums": [],
					"messages": [],
					"options": {}
				}
			],
			"enums": [],
			"imports": [],
			"options": {}
		}).import({
			"package": null,
			"messages": [],
			"enums": [],
			"imports": [],
			"options": {},
			"extend": [
				{
					"name": "Foo",
					"fields": [
						{
							"rule": "optional",
							"type": "string",
							"name": "buzz",
							"id": 3,
							"options": {}
						}
					],
					"enums": [],
					"messages": [],
					"options": {}
				}
			]
		}).build();
	});



	require(['dtos'], function(dtos){

		var foo = new dtos.Foo();

		// console.log(foo);
		foo.setFizz('fizz');
		foo.setBuzz('buzz');
		console.log(foo);
		// foo.encode(bb);


		var ws = new WebSocket('ws://localhost:3333');
		ws.binary = true;
		ws.binaryType = 'arraybuffer';
		ws.onmessage = function(event) {
			console.log(event.data);
			console.log(dtos.Foo.decode(event.data));
		};
		// var socket = io.connect('http://localhost');

//		socket.on('data', function(data){
//			// console.log(bb);
//			console.log(data, data instanceof ArrayBuffer); // { }, false
//			var decoded = Foo.decode(data);
//			// console.assert(bb.toHex() == data);
//			var decoded = Foo.decode(data.tab);
//			console.log(decoded);
//			return;
//			var b = new ByteBuffer();
//			bb.wrap(data);
//
//			// var foo = Foo.decode(data);
//			// console.log(foo);
//		});
		// var foo = Foo.decode('<0A 03 34 34 34 12 07 44 69 6D 69 74 61 72>00 00');
		// console.log(foo.decode(data));


		// console.log(foo, foo.toArrayBuffer());
	});
</script>

</body>
</html>